"use strict";exports.id=485,exports.ids=[485],exports.modules={6249:(t,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function t(e,r){return r in e?e[r]:"then"in e&&"function"==typeof e.then?e.then(e=>t(e,r)):"function"==typeof e&&"default"===r?e:void 0}}})},5849:(t,e,r)=>{r.d(e,{$Q:()=>h,$S:()=>c,dE:()=>d,gd:()=>g,rK:()=>n,zz:()=>a});let o="zGrtVQbRA6bHEbuehwVxooi0z4OD2xvi",i="https://api.massive.com";async function a(t){try{let e=await fetch(`${i}/v2/aggs/ticker/${t}/prev?adjusted=true&apiKey=${o}`);if(!e.ok)throw Error(`Failed to fetch stock price: ${e.status}`);let r=await e.json(),a=r.results?.[0]?.c;if(!a||a<=0)throw Error("Invalid stock price data");return a}catch(e){throw console.error(`Error fetching stock price for ${t}:`,e),e}}async function n(t,e,r){try{let a=await fetch(`${i}/v2/aggs/ticker/${t}/range/1/day/${e}/${r}?adjusted=true&sort=asc&apiKey=${o}`);if(!a.ok)throw Error(`Failed to fetch historical data: ${a.status}`);let n=(await a.json()).results||[];if(0===n.length)throw Error("No historical data available");return n.map(t=>({date:new Date(t.t).toISOString().split("T")[0],open:t.o,high:t.h,low:t.l,close:t.c,volume:t.v})).sort((t,e)=>new Date(t.date)-new Date(e.date))}catch(e){throw console.error(`Error fetching historical data for ${t}:`,e),e}}async function c(t){try{let e=await fetch(`${i}/v3/reference/options/contracts?underlying_ticker=${t}&limit=1000&apiKey=${o}`);if(!e.ok)throw Error(`Failed to fetch options contracts: ${e.status}`);return(await e.json()).results||[]}catch(e){throw console.error(`Error fetching options contracts for ${t}:`,e),e}}async function l(t){try{let e=await fetch(`${i}/v2/aggs/ticker/${t}/prev?adjusted=true&apiKey=${o}`);if(!e.ok)return 0;let r=await e.json();if(r.results&&Array.isArray(r.results)&&r.results.length>0)return r.results[0].c||0;return 0}catch(e){return console.error(`Error fetching previous day close for ${t}:`,e),0}}async function s(t,e){let r={};e.forEach(t=>{r[t]={price:0,bid:0,ask:0,volume:0,openInterest:0,impliedVolatility:0,greeks:null}});try{let a=await fetch(`${i}/v3/snapshot/options/${t}?limit=250&apiKey=${o}`);if(!a.ok)return console.error(`HTTP ${a.status} fetching options snapshot for ${t}`),await p(e,r),r;let n=await a.json();if(!n.results||!Array.isArray(n.results))return console.error("Invalid response format from options snapshot API"),await p(e,r),r;let c=new Map(e.map(t=>[t.toLowerCase(),t]));for(let t of n.results){let o=t.details?.ticker||t.ticker;if(!o)continue;let i=c.get(o.toLowerCase()),a=o.replace(/^O:/i,""),n=i||e.find(t=>t.replace(/^O:/i,"").toLowerCase()===a.toLowerCase());if(n){let e=0;t.last_trade?.p?e=t.last_trade.p:t.last_quote?.b&&t.last_quote?.a?e=(t.last_quote.b+t.last_quote.a)/2:t.last_quote?.p&&(e=t.last_quote.p),r[n]={price:e,bid:t.last_quote?.b||0,ask:t.last_quote?.a||0,volume:t.day?.v||0,openInterest:t.open_interest||0,impliedVolatility:t.implied_volatility||0,greeks:t.greeks||null}}}let l=e.filter(t=>0===r[t].price);l.length>0&&(console.log(`Fetching previous day close prices for ${l.length} contracts without real-time pricing`),await p(l,r)),n.next_url&&e.some(t=>0===r[t].price)&&console.warn("Some contracts not found in first page. Consider implementing pagination if needed.")}catch(o){console.error(`Error fetching options snapshot for ${t}:`,o),await p(e,r)}return r}async function p(t,e){let r=t.map(async t=>{let r=await l(t);r>0&&0===e[t].price&&(e[t].price=r,console.log(`Using previous day close price for ${t}: $${r}`))});await Promise.all(r)}function u(t,e){let r=new Date(e),o=null,i=1/0;for(let e of t)if(e.expiration_date){let t=Math.abs(new Date(e.expiration_date)-r);t<i&&(i=t,o=e.expiration_date)}return o}function f(t,e,r){let o=t.filter(t=>t.contract_type===r);if(0===o.length)return null;let i=null,a=1/0;for(let t of o){let r=Math.abs(t.strike_price-e);r<a&&(a=r,i=t.strike_price)}return i}async function h(t,e){try{let r=await a(t),o=await c(t);if(0===o.length)throw Error("No options contracts found");let i=u(o,e);if(!i)throw Error("No valid expiration dates found");let n=o.filter(t=>t.expiration_date===i),l=f(n,r,"call"),p=f(n,r,"put");if(!l||!p)throw Error("No ATM options found for this expiration");let h=n.find(t=>"call"===t.contract_type&&t.strike_price===l),d=n.find(t=>"put"===t.contract_type&&t.strike_price===p);if(!h||!d)throw Error("Matching call and put contracts not found");let g=await s(t,[h.ticker,d.ticker]),w=g[h.ticker]||{price:0},k=g[d.ticker]||{price:0};return{ticker:t.toUpperCase(),currentPrice:r,expiration:i,requestedExpiration:e,strikePrice:l,callPrice:w.price,putPrice:k.price,totalPremium:w.price+k.price,callTicker:h.ticker,putTicker:d.ticker,callData:w,putData:k,dataSource:"polygon_real_time",dataQuality:w.price>0&&k.price>0?"high":"low"}}catch(e){throw console.error(`Error getting straddle options for ${t}:`,e),e}}async function d(t,e,r=10){try{let o=await a(t),i=await c(t);if(0===i.length)throw Error("No options contracts found");let n=u(i,e);if(!n)throw Error("No valid expiration dates found");let l=i.filter(t=>t.expiration_date===n),p=5*Math.round(o/5),f=p+r,h=p-r,d=l.find(t=>"call"===t.contract_type&&t.strike_price===p),g=l.find(t=>"put"===t.contract_type&&t.strike_price===p),w=l.find(t=>"call"===t.contract_type&&t.strike_price===f),k=l.find(t=>"put"===t.contract_type&&t.strike_price===h),y=[];if(d||y.push(`Short Call ${p}`),g||y.push(`Short Put ${p}`),w||y.push(`Long Call ${f}`),k||y.push(`Long Put ${h}`),y.length>0)throw Error(`Missing contracts: ${y.join(", ")}`);let _=[d.ticker,g.ticker,w.ticker,k.ticker],P=await s(t,_),$=P[d.ticker]||{price:0},E=P[g.ticker]||{price:0},m=P[w.ticker]||{price:0},v=P[k.ticker]||{price:0},x=$.price-m.price,A=E.price-v.price,C=x+A;return{ticker:t.toUpperCase(),currentPrice:o,expiration:n,requestedExpiration:e,strikes:{shortCall:p,shortPut:p,longCall:f,longPut:h},premiums:{shortCallPrice:$.price,shortPutPrice:E.price,longCallPrice:m.price,longPutPrice:v.price,callCredit:x,putCredit:A,totalCredit:C},contracts:{shortCall:d.ticker,shortPut:g.ticker,longCall:w.ticker,longPut:k.ticker},snapshotData:{shortCall:$,shortPut:E,longCall:m,longPut:v},wingWidth:r,isNetCredit:C>0,dataSource:"polygon_real_time",dataQuality:Object.values(P).every(t=>t.price>0)?"high":"low"}}catch(e){throw console.error(`Error getting iron condor options for ${t}:`,e),e}}function g(t,e){let r=[];if(!t||0===t.length||e<=0)return r;let o=[...t].sort((t,e)=>new Date(e.date)-new Date(t.date));if(o.length<e+1)return r;let i=0,a=0;for(;i+e<o.length&&a<200;){let t=o[i],n=o[i+e];if(t.close>0&&n.close>0){let o=(t.close-n.close)/n.close;r.push({startDate:t.date,endDate:n.date,startPrice:t.close,endPrice:n.close,percentMove:o}),i+=e,a++}else i++}return r}},7153:(t,e)=>{var r;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return r}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(t,e,r)=>{t.exports=r(145)}};