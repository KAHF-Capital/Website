"use strict";(()=>{var e={};e.id=694,e.ids=[694],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6493:e=>{e.exports=require("node-fetch")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},4006:(e,t,r)=>{r.r(t),r.d(t,{config:()=>w,default:()=>b,routeModule:()=>k});var o={};r.r(o),r.d(o,{default:()=>$});var a=r(1802),i=r(7153),n=r(6249),s=r(6493),l=r.n(s);let c="https://query2.finance.yahoo.com/v7/finance/options",u=null,p=0,h=new Map;async function d(){let e=Date.now();if(u&&e-p<18e5)return u;try{let t=await l()("https://finance.yahoo.com/quote/AAPL",{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive","Upgrade-Insecure-Requests":"1"}}),r=(await t.text()).match(/"CrumbStore":\{"crumb":"([^"]+)"/);if(r&&r[1]){let t=r[1].replace(/\\u002F/g,"/");return u=t,p=e,t}throw Error("Could not extract crumb from Yahoo Finance")}catch(e){throw console.error("Error getting Yahoo Finance crumb:",e.message),e}}async function g(e){try{let t=`https://query1.finance.yahoo.com/v8/finance/chart/${e}`,r=await l()(t,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9","Accept-Encoding":"gzip, deflate, br",Referer:"https://finance.yahoo.com/",Origin:"https://finance.yahoo.com"}});if(!r.ok)throw Error(`Yahoo Finance API error: ${r.status}`);let o=await r.json();if(!o.chart||!o.chart.result||0===o.chart.result.length)throw Error("No price data available");let a=o.chart.result[0];return{price:a.meta.regularMarketPrice,currency:a.meta.currency,exchange:a.meta.exchangeName,timestamp:a.meta.regularMarketTime}}catch(t){throw console.error(`Error fetching current price for ${e}:`,t.message),t}}async function f(e){try{let t=await d(),r=`${c}/${e}?crumb=${t}`,o=await l()(r,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9","Accept-Encoding":"gzip, deflate, br",Referer:"https://finance.yahoo.com/",Origin:"https://finance.yahoo.com"}});if(!o.ok)throw Error(`Yahoo Finance options API error: ${o.status}`);let a=await o.json();if(!a.optionChain||!a.optionChain.result||0===a.optionChain.result.length)throw Error("No options data available");return(a.optionChain.result[0].expirationDates||[]).map(e=>new Date(1e3*e).toISOString().split("T")[0]).sort()}catch(t){throw console.error(`Error fetching expiration dates for ${e}:`,t.message),t}}async function m(e,t){let r=`${e}-${t}`,o=Date.now();if(h.has(r)){let e=h.get(r);if(o-e.timestamp<3e5)return e.data}try{let a=await d(),i=Math.floor(new Date(t).getTime()/1e3),n=`${c}/${e}?date=${i}&crumb=${a}`,s=await l()(n,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9","Accept-Encoding":"gzip, deflate, br",Referer:"https://finance.yahoo.com/",Origin:"https://finance.yahoo.com"}});if(!s.ok)throw Error(`Yahoo Finance options API error: ${s.status}`);let u=await s.json();if(!u.optionChain||!u.optionChain.result||0===u.optionChain.result.length)throw Error("No options data available for this expiration");let p=u.optionChain.result[0],g=p.quote.regularMarketPrice,f=p.options[0]?.calls||[],m=p.options[0]?.puts||[];if(0===f.length||0===m.length)throw Error("No options contracts available");let P=5*Math.round(g/5),$=P+10,b=P-10,w=f.find(e=>e.strike===P),k=m.find(e=>e.strike===P),y=f.find(e=>e.strike===$),A=m.find(e=>e.strike===b),C=[];if(w||C.push(`Short Call ${P}`),k||C.push(`Short Put ${P}`),y||C.push(`Long Call ${$}`),A||C.push(`Long Put ${b}`),C.length>0)return{error:"Missing required contracts",missingContracts:C,availableStrikes:{calls:[...new Set(f.map(e=>e.strike))].sort((e,t)=>e-t),puts:[...new Set(m.map(e=>e.strike))].sort((e,t)=>e-t)},requestedStrikes:{shortCall:P,shortPut:P,longCall:$,longPut:b}};let x=(w.bid+w.ask)/2,E=(k.bid+k.ask)/2,q=(y.bid+y.ask)/2,S=(A.bid+A.ask)/2,M=x-q,v=E-S,D=M+v,T=q+S;console.log(`Iron Condor Premiums for ${e}:`,{shortCall:{strike:P,bid:w.bid,ask:w.ask,mid:x},shortPut:{strike:P,bid:k.bid,ask:k.ask,mid:E},longCall:{strike:$,bid:y.bid,ask:y.ask,mid:q},longPut:{strike:b,bid:A.bid,ask:A.ask,mid:S},credits:{callCredit:M,putCredit:v,totalCredit:D},debits:{callDebit:q,putDebit:S,totalDebit:T}});let j={ticker:e.toUpperCase(),currentPrice:g,expiration:t,requestedExpiration:t,executionDate:new Date().toISOString().split("T")[0],strikes:{shortCall:P,shortPut:P,longCall:$,longPut:b},premiums:{shortCallPrice:x,shortPutPrice:E,longCallPrice:q,longPutPrice:S,callCredit:M,putCredit:v,callDebit:q,putDebit:S,totalCredit:D,totalDebit:T},contracts:{shortCall:`${e}${t.replace(/-/g,"")}C${P}000`,shortPut:`${e}${t.replace(/-/g,"")}P${P}000`,longCall:`${e}${t.replace(/-/g,"")}C${$}000`,longPut:`${e}${t.replace(/-/g,"")}P${b}000`},wingWidth:10,isNetCredit:D>0,source:"yahoo_finance",dataQuality:"high"};return h.set(r,{data:j,timestamp:o}),j}catch(r){throw console.error(`Error fetching options data for ${e} ${t}:`,r.message),r}}async function P(e,t=null){try{let r=(await g(e)).price,o=[];try{o=await f(e)}catch(t){console.warn(`Could not get expiration dates for ${e}:`,t.message)}if(!t)return{ticker:e,currentPrice:r,availableExpirations:o,message:"Please select an expiration date from the available options",source:"expiration_list",dataQuality:"none"};if(o.length>0&&!o.includes(t))return{ticker:e,currentPrice:r,availableExpirations:o,requestedExpiration:t,message:`Requested expiration date ${t} is not available. Please check Yahoo Finance options for ${e} to see available dates.`,yahooFinanceUrl:`https://finance.yahoo.com/quote/${e}/options`,source:"expiration_not_available",dataQuality:"none"};try{let a=await m(e,t);if(a.error)return{...a,ticker:e,currentPrice:r,availableExpirations:o,requestedExpiration:t};return{...a,availableExpirations:o,requestedExpiration:t}}catch(a){return console.warn(`Could not get options data for ${e} ${t}, using estimation:`,a.message),{...function(e,t,r){let o=new Date(r),a=new Date,i=.25*t*Math.sqrt(Math.ceil((o-a)/864e5)/365)*.4,n=5*Math.round(t/5),s=n+10,l=n-10,c=.3*i,u=.3*i,p=i-c,h=i-u,d=p+h;return{ticker:e.toUpperCase(),currentPrice:t,expiration:r,executionDate:new Date().toISOString().split("T")[0],strikes:{shortCall:n,shortPut:n,longCall:s,longPut:l},premiums:{shortCallPrice:i,shortPutPrice:i,longCallPrice:c,longPutPrice:u,callCredit:p,putCredit:h,callDebit:c,putDebit:u,totalCredit:d,totalDebit:c+u},contracts:{shortCall:`${e}${r.replace(/-/g,"")}C${n}000`,shortPut:`${e}${r.replace(/-/g,"")}P${n}000`,longCall:`${e}${r.replace(/-/g,"")}C${s}000`,longPut:`${e}${r.replace(/-/g,"")}P${l}000`},wingWidth:10,isNetCredit:d>0}}(e,r,t),availableExpirations:o,requestedExpiration:t,source:"estimation",dataQuality:"medium",note:"Options data estimated due to Yahoo Finance API limitations"}}}catch(t){throw console.error(`Error getting iron condor data for ${e}:`,t.message),t}}async function $(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let{ticker:r,expiration:o}=e.query;if(!r)return t.status(400).json({error:"Ticker is required"});try{let e=await P(r,o);if(e.error)return t.status(404).json(e);return e.message,t.status(200).json(e)}catch(e){return console.error("Error in iron-condor-options-yahoo API:",e),t.status(500).json({error:"Failed to fetch iron condor options",details:"Please try again later"})}}let b=(0,n.l)(o,"default"),w=(0,n.l)(o,"config"),k=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/iron-condor-options-yahoo",pathname:"/api/iron-condor-options-yahoo",bundlePath:"",filename:""},userland:o})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=4006);module.exports=r})();