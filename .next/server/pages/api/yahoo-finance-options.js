"use strict";(()=>{var t={};t.id=252,t.ids=[252],t.modules={145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4809:t=>{t.exports=require("node-fetch")},6249:(t,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function t(e,r){return r in e?e[r]:"then"in e&&"function"==typeof e.then?e.then(e=>t(e,r)):"function"==typeof e&&"default"===r?e:void 0}}})},7371:(t,e,r)=>{r.r(e),r.d(e,{config:()=>y,default:()=>w,routeModule:()=>P});var a={};r.r(a),r.d(a,{default:()=>g});var o=r(1802),n=r(7153),i=r(6249),s=r(4809),l=r.n(s);let u="https://query2.finance.yahoo.com/v7/finance/options",c=new Map;async function p(t){try{let e=`https://query1.finance.yahoo.com/v8/finance/chart/${t}`,r=await l()(e);if(!r.ok)throw Error(`Yahoo Finance API error: ${r.status}`);let a=await r.json();if(!a.chart||!a.chart.result||0===a.chart.result.length)throw Error("No price data available");let o=a.chart.result[0];return{price:o.meta.regularMarketPrice,currency:o.meta.currency,exchange:o.meta.exchangeName,timestamp:o.meta.regularMarketTime}}catch(e){throw console.error(`Error fetching current price for ${t}:`,e.message),e}}async function h(t){try{let e=`${u}/${t}`,r=await l()(e);if(!r.ok)throw Error(`Yahoo Finance options API error: ${r.status}`);let a=await r.json();if(!a.optionChain||!a.optionChain.result||0===a.optionChain.result.length)throw Error("No options data available");return(a.optionChain.result[0].expirationDates||[]).map(t=>new Date(1e3*t).toISOString().split("T")[0]).sort()}catch(e){throw console.error(`Error fetching expiration dates for ${t}:`,e.message),e}}async function d(t,e){let r=`${t}-${e}`,a=Date.now();if(c.has(r)){let t=c.get(r);if(a-t.timestamp<3e5)return t.data}try{let o=Math.floor(new Date(e).getTime()/1e3),n=`${u}/${t}?date=${o}`,i=await l()(n);if(!i.ok)throw Error(`Yahoo Finance options API error: ${i.status}`);let s=await i.json();if(!s.optionChain||!s.optionChain.result||0===s.optionChain.result.length)throw Error("No options data available for this expiration");let p=s.optionChain.result[0],h=p.quote.regularMarketPrice,d=p.options[0]?.calls||[],f=p.options[0]?.puts||[];if(0===d.length||0===f.length)throw Error("No options contracts available");let m=null,g=1/0;if(d.forEach(t=>{let e=Math.abs(t.strike-h);e<g&&(g=e,m=t.strike)}),!m)throw Error("Could not find ATM strike price");let w=d.find(t=>t.strike===m),y=f.find(t=>t.strike===m);if(!w||!y)throw Error("Could not find ATM call and put options");let P=(w.bid+w.ask)/2,k=(y.bid+y.ask)/2,E={ticker:t,expirationDate:e,currentPrice:h,strikePrice:m,callOption:{strike:w.strike,bid:w.bid,ask:w.ask,mid:P,volume:w.volume,openInterest:w.openInterest},putOption:{strike:y.strike,bid:y.bid,ask:y.ask,mid:k,volume:y.volume,openInterest:y.openInterest},totalPremium:P+k,dataQuality:"high"};return c.set(r,{data:E,timestamp:a}),E}catch(r){throw console.error(`Error fetching options data for ${t} ${e}:`,r.message),r}}async function f(t,e=null,r=30){try{let a=(await p(t)).price,o=[];try{o=await h(t)}catch(e){console.warn(`Could not get expiration dates for ${t}:`,e.message)}if(!e)return{ticker:t,currentPrice:a,availableExpirations:o,message:"Please select an expiration date from the available options",source:"expiration_list",dataQuality:"none"};if(o.length>0&&!o.includes(e))return{ticker:t,currentPrice:a,requestedExpiration:e,availableExpirations:o,message:`Requested expiration date ${e} is not available`,source:"expiration_not_available",dataQuality:"none"};try{return{...await d(t,e),availableExpirations:o,source:"yahoo_finance",executionDate:new Date().toISOString().split("T")[0]}}catch(i){console.warn(`Could not get options data for ${t} ${e}, using estimation:`,i.message);let n=function(t,e,r=.3){return Math.max(t*r*Math.sqrt(e/365)*.4,.01*t)}(a,r);return{ticker:t,expirationDate:e,currentPrice:a,strikePrice:a,totalPremium:n,availableExpirations:o,source:"estimation",executionDate:new Date().toISOString().split("T")[0],dataQuality:"medium",note:"Premium estimated using Black-Scholes approximation"}}}catch(e){throw console.error(`Error getting straddle data for ${t}:`,e.message),e}}async function m(t,e=3,r=1e3){let a=[];for(let o=0;o<t.length;o+=e){let n=t.slice(o,o+e).map(async t=>{try{let e=await f(t.ticker,null,30);return{...t,straddleData:e}}catch(e){return console.error(`Error processing ${t.ticker}:`,e.message),{...t,error:e.message,straddleData:null}}}),i=await Promise.all(n);a.push(...i),o+e<t.length&&await new Promise(t=>setTimeout(t,r))}return a}async function g(t,e){if("GET"!==t.method)return e.status(405).json({error:"Method not allowed"});let{ticker:r,expiration:a,batch:o}=t.query;try{if("true"===o){let{tickers:r}=t.body||{};if(!r||!Array.isArray(r))return e.status(400).json({error:"Missing tickers array in request body for batch processing"});let a=await m(r);return e.status(200).json({timestamp:new Date().toISOString(),totalTickers:r.length,results:a})}if(!r)return e.status(400).json({error:"Missing required parameter: ticker or batch=true"});{let t=await f(r,a);return e.status(200).json(t)}}catch(t){return console.error("Error in yahoo-finance-options API:",t),e.status(500).json({error:"Failed to fetch options data",details:"Please try again later"})}}let w=(0,i.l)(a,"default"),y=(0,i.l)(a,"config"),P=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/yahoo-finance-options",pathname:"/api/yahoo-finance-options",bundlePath:"",filename:""},userland:a})},7153:(t,e)=>{var r;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return r}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(t,e,r)=>{t.exports=r(145)}};var e=require("../../webpack-api-runtime.js");e.C(t);var r=e(e.s=7371);module.exports=r})();