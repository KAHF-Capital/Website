"use strict";(()=>{var e={};e.id=120,e.ids=[120],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},5835:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>u,routeModule:()=>d});var a={};r.r(a),r.d(a,{default:()=>l});var o=r(1802),n=r(7153),i=r(6249);async function l(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let{ticker:r,strikePrice:a,totalPremium:o,daysToExpiration:n}=e.body;if(!r||!o)return t.status(400).json({error:"Missing required parameters: ticker and totalPremium are required"});let i=a||100;try{let e=await s(r,n||30),a=function(e,t,r){let a=0,o=0,n=0;if(!e||0===e.length)return{aboveUpper:0,belowLower:0,totalProfitable:0,totalSamples:0,profitableRate:0,aboveUpperPct:0,belowLowerPct:0,upperBreakevenPct:100*t,lowerBreakevenPct:100*r,avgMove:0,maxMove:0,minMove:0,dataQuality:"none"};let i=e.filter(e=>.5>=Math.abs(e.percentMove));0===i.length&&(i=e),i.forEach(e=>{let i=e.percentMove;i>t&&a++,i<r&&o++,n++});let l=a+o,s=n>0?l/n*100:0,c=i.length>0?i.reduce((e,t)=>e+Math.abs(t.percentMove),0)/i.length:0,u=i.length>0?Math.max(...i.map(e=>Math.abs(e.percentMove))):0,p=i.length>0?Math.min(...i.map(e=>Math.abs(e.percentMove))):0;return{aboveUpper:a,belowLower:o,totalProfitable:l,totalSamples:n,profitableRate:s,aboveUpperPct:n>0?a/n*100:0,belowLowerPct:n>0?o/n*100:0,upperBreakevenPct:100*t,lowerBreakevenPct:100*r,avgMove:100*c,maxMove:100*u,minMove:100*p,dataQuality:n>=100?"high":n>=50?"medium":"low"}}(e,(i+o-i)/i,(i-o-i)/i);t.status(200).json(a)}catch(e){console.error("Error in straddle analysis:",e),t.status(500).json({error:"Failed to perform analysis"})}}async function s(e,t){try{let r=process.env.ALPHA_VANTAGE_API_KEY||"demo",a=`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${e}&apikey=${r}`,o=await fetch(a),n=await o.json();if(n["Error Message"])throw console.log(`Alpha Vantage error for ${e}:`,n["Error Message"]),Error("Invalid ticker symbol");if(n.Note)return console.log(`Alpha Vantage API limit reached for ${e}, using mock data`),c(t);let i=n["Time Series (Daily)"];if(!i)throw console.log(`No time series data for ${e}`),Error("No historical data available");let l=Object.entries(i).map(([e,t])=>({date:e,price:parseFloat(t["4. close"])})).filter(e=>!isNaN(e.price)&&e.price>0).sort((e,t)=>new Date(e.date)-new Date(t.date));if(0===l.length)throw console.log(`No valid price data for ${e}`),Error("No valid historical price data");let s=function(e,t){let r=[];if(e.length<t+1)return r;for(let a=0;a<e.length-t;a++){let o=e[a].price,n=e[a+t].price;if(o>0&&n>0){let i=(n-o)/o;r.push({startDate:e[a].date,endDate:e[a+t].date,startPrice:o,endPrice:n,percentMove:i})}}return r}(l,t);if(0===s.length)return console.log(`No price movements calculated for ${e}, using mock data`),c(t);return s}catch(r){return console.error(`Error fetching historical data for ${e}:`,r.message),c(t)}}function c(e){let t=[],r=Math.min(250,Math.max(100,500-e));for(let a=0;a<r;a++){let o=0,n=100;for(let t=0;t<e;t++){let e=(Math.random()-.5)*.04+(100-n)*5e-4;o+=e,n*=1+e}let i=new Date;i.setDate(i.getDate()-(r-a)*2);let l=new Date(i);l.setDate(l.getDate()+e),t.push({startDate:i.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0],startPrice:100,endPrice:100*(1+o),percentMove:o})}return t}let u=(0,i.l)(a,"default"),p=(0,i.l)(a,"config"),d=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/straddle-analysis",pathname:"/api/straddle-analysis",bundlePath:"",filename:""},userland:a})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=5835);module.exports=r})();