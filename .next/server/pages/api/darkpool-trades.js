"use strict";(()=>{var e={};e.id=937,e.ids=[937],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4809:e=>{e.exports=require("node-fetch")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8160:(e,r,t)=>{t.r(r),t.d(r,{config:()=>y,default:()=>g,routeModule:()=>v});var a={};t.r(a),t.d(a,{default:()=>P});var n=t(1802),o=t(7153),i=t(6249),s=t(4809),c=t.n(s);let l=t(2048),u=t(5315),d=u.join(process.cwd(),"data"),p=u.join(d,"processed");async function f(e){try{let r=`https://query1.finance.yahoo.com/v8/finance/chart/${e}`,t=await c()(r);if(!t.ok)return null;let a=await t.json();if(!a.chart||!a.chart.result||0===a.chart.result.length)return null;let n=a.chart.result[0].meta,o=n.regularMarketPrice,i=n.previousClose,s=o-i;return{currentPrice:o,previousClose:i,change:s,changePercent:s/i*100}}catch(r){return console.error(`Error fetching performance for ${e}:`,r.message),null}}async function h(e,r=5,t=200){let a={};for(let n=0;n<e.length;n+=r){let o=e.slice(n,n+r).map(async e=>{let r=await f(e);return{ticker:e,performance:r}});(await Promise.all(o)).forEach(({ticker:e,performance:r})=>{a[e]=r}),n+r<e.length&&await new Promise(e=>setTimeout(e,t))}return a}async function m(){try{let e=l.readdirSync(p).filter(e=>e.endsWith(".json")&&!e.includes("summary")).map(e=>{let r=e.match(/(\d{4}-\d{2}-\d{2})/);return{date:r?r[1]:null,path:u.join(p,e)}}).filter(e=>e.date).sort((e,r)=>r.date.localeCompare(e.date));if(0===e.length)return null;let r=e[0],t=JSON.parse(l.readFileSync(r.path,"utf8")),a=r.date,n=new Date(a),o=new Date(n);o.setDate(n.getDate()-6);let i=e.filter(e=>{let r=new Date(e.date);return r>=o&&r<=n}).slice(0,7),s={},c={};i.forEach(e=>{try{JSON.parse(l.readFileSync(e.path,"utf8")).tickers.forEach(e=>{s[e.ticker]||(s[e.ticker]=0,c[e.ticker]=0),s[e.ticker]+=e.total_volume,c[e.ticker]++})}catch(r){console.error(`Error reading file ${e.path}:`,r)}}),Object.keys(s).forEach(e=>{s[e]=Math.round(s[e]/c[e])});let d=t.tickers.filter(e=>{let r=e.total_value,t=e.avg_price;return r>25e7&&t>50}),f=d.map(e=>e.ticker),m=await h(f),P=d.map(e=>{let r=m[e.ticker],t=s[e.ticker]>0?(e.total_volume/s[e.ticker]).toFixed(2):"N/A";return{...e,avg_7day_volume:s[e.ticker]||0,volume_ratio:t,performance:r?{currentPrice:r.currentPrice,previousClose:r.previousClose,change:r.change,changePercent:r.changePercent}:null}});return{date:a,total_tickers:t.total_tickers,total_volume:t.total_volume,last_updated:t.processed_at||new Date().toISOString(),tickers:P}}catch(e){return console.error("Error reading processed data:",e),null}}async function P(e,r){try{l.existsSync(d)||l.mkdirSync(d,{recursive:!0}),l.existsSync(p)||l.mkdirSync(p,{recursive:!0});let e=await m();if(!e)return r.status(404).json({error:"No processed data found",message:"Please process CSV files first using the command line processor",instructions:["1. Place your CSV files in the data/daily folder","2. Run: node process-csv.js","3. Refresh this page to view the results"]});return r.status(200).json(e)}catch(e){return console.error("Error in darkpool-trades API:",e),r.status(500).json({error:"Error loading processed data",details:"Please try again later"})}}let g=(0,i.l)(a,"default"),y=(0,i.l)(a,"config"),v=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/darkpool-trades",pathname:"/api/darkpool-trades",bundlePath:"",filename:""},userland:a})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=8160);module.exports=t})();